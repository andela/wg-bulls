{% extends "base.html" %}
{% load i18n %}
{% load staticfiles %}
{% load wger_extras %}
{% load cache %}

{% block header %}
    <script>
        $(document).ready(function () {
            // Prevent the form from being submited if JavaScript is enabled
            $("#search_form").submit(function () {
                return false;
            });

            // Init the autocompleter
            $("#ingredient-search").autocomplete({
                serviceUrl: '/api/v2/ingredient/search/',
                dataType: 'json',
                paramName: 'term',
                minChars: 3,
                onSelect: function (suggestion) {
                     window.location.href = '/nutrition/ingredient/' + suggestion.data.id + '/view/'
                }
            });

            var loc = $(location).attr('search');
            var str = "Filter by language: ";
            if (loc == "?lang=en"){
                    $('#filter-lang').text(str + "English");
                }
            if (loc == "?lang=de"){
                    $('#filter-lang').text(str + "German");
                }
            if (loc == "?lang=bg"){
                    $('#filter-lang').text(str + "Bulgaria");
                }
            if (loc == "?lang=es"){
                    $('#filter-lang').text(str + "Spanish");
                }
            if (loc == "?lang=ru"){
                    $('#filter-lang').text(str + "Russian");
                }
            if (loc == "?lang=nl"){
                    $('#filter-lang').text(str + "Dutch");
                }
            if (loc == "?lang=pt"){
                    $('#filter-lang').text(str + "Portuguese");
                }
            if (loc == "?lang=el"){
                    $('#filter-lang').text(str + "Greek");
                }
            if (loc == "?lang=cs"){
                    $('#filter-lang').text(str + "Czeck");
                }
            if (loc == "?lang=sv"){
                    $('#filter-lang').text(str + "Swedish");
                }
            if (loc == "?lang=no"){
                    $('#filter-lang').text(str + "Norwegian");
                }
        });
    </script>
{% endblock %}

{% block title %}{% trans "Ingredient overview" %}
<div class="btn-group" style="float:right;">
    <button id="filter-lang" type="button" class="btn btn-primary dropdown-toggle btn-xs" data-toggle="dropdown">
        {% trans "Filter by language" %}
        <span class="caret"></span>
    </button>
    <ul class="dropdown-menu" role="menu">
        <li><a href={% url 'nutrition:ingredient:list' %}>None</a></li>
            {% for sn, language in languages %}
            <li>
                <a href={% url 'nutrition:ingredient:list' %}?lang={{ sn }}> {{ language }} </a>
            </li>
            {% endfor %}
    </ul>
</div>

{% endblock %}


{% block content %}
    {% if ingredients_list %}
        <div class="list-group">
            {% for ingredient in ingredients_list %}
                <a class="list-group-item"
                   href="{{ ingredient.get_absolute_url }}">
                    {% if flavour == 'mobile' %}
                        <span class="glyphicon glyphicon-chevron-right pull-right"></span>
                    {% endif %}
                    {{ ingredient.name }}
                </a>
            {% endfor %}
        </div>
    {% else %}
        <p>
            <a href="{% url 'nutrition:ingredient:add' %}"
               class="btn btn-default btn-block">
                {% trans "No ingredients." %} {% trans "Add one now." %}
            </a>
        </p>
    {% endif %}


    <div style="padding-top:3em;"></div>
    {% pagination paginator page_obj %}
{% endblock %}

{% block sidebar %}

    <h4>{% trans "Search" %}</h4>
    <form action="{% url 'ingredient-search' %}"
          method="get"
          id="search_form">
        {% csrf_token %}
        <input name="term"
               type="search"
               id="ingredient-search"
               class="ajax-form-element form-control"
               placeholder="{% trans 'ingredient name' %}"
               style="width:100%;">
    </form>
{% endblock %}


{#         #}
{# Options #}
{#         #}
{% block options %}
    {% if user.is_authenticated and not user.userprofile.is_temporary %}
        <a href="{% url 'nutrition:ingredient:add' %}"
           class="btn btn-success btn-sm">
            {% trans "Add ingredient" %}
        </a>
    {% else %}
        <a href="#" class="btn btn-success btn-sm disabled">
            {% trans "Add ingredient" %}<br>
            <small>
                {% trans "Only registered users can do this" %}
            </small>
        </a>
    {% endif %}
{% endblock %}
